<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.water.Mulbburi.community.dao.CommunityMapper">

 <resultMap type="com.water.Mulbburi.community.dto.CommunityDTO" id="communityAllResultMap">
      <id property="communityNo" column="COMMUNITY_NO"/>
      <result property="communityTitle" column="COMMUNITY_TITLE"/>
      <result property="communityStory" column="COMMUNITY_STORY"/>
      <result property="communityWriteDate" column="COMMUNITY_WRITE_DATE"/>
      <result property="communityUpdateDate" column="COMMUNITY_UPDATE_DATE"/>
      <result property="communityDeleteDate" column="COMMUNITY_DELET_DATE"/>
      <result property="memberNo" column="MEMBER_NO"/>
      <result property="custom" column="CUSTOM"/>
     </resultMap>

 
    <resultMap type="com.water.Mulbburi.community.dto.AttachmentDTO" id="attachmentResultMap">
        <id property="no" column="FILE_NO"></id>
        <result property="refBoardNo" column="REF_BOARD_NO"/>
        <result property="originalName" column="FILE_ORIGINAL_NAME"/>
        <result property="savedName" column="FILE_SAVED_NAME"/>
        <result property="savePath" column="FILE_PATH"/>
        <result property="fileType" column="FILE_SIZE"/>
        <result property="thumbnailPath" column="COMMUNITY_NO"/>
        <result property="status" column="CUSTOM"/>
        
    </resultMap>






 <select id="selectThumbnailTotalCount" resultType="_int">
        SELECT 
        	   COUNT(*)
          FROM COMMUNITY 
         WHERE CUSTOM = 1
    </select>
    


 <insert id="insertThumbnailContent" >
        INSERT 
        INTO COMMUNITY
        (
          COMMUNITY_NO
        , COMMUNITY_TITLE
        , COMMUNITY_STORY
        , COMMUNITY_WRITE_DATE
        , MEMBER_NO
        , CUSTOM
        )
        VALUES
        (
        SEQ_COMMUNITY_NO.NEXTVAL
        , #{ title }
        , #{ story }
        , SYSDATE
        , 1
        , 1
        )
    </insert>
    <select id="selectThumbnailCommunityList">
        SELECT 
	           A.COMMUNITY_NO
	         , A.BOARD_TYPE
	         , D.FILE_SIZE
	         , D.COMMUNITY_NO
	         , A.COMMUNITY_TITLE
	         , A.COMMUNITY_STORY
	         , A.MEMBER_NO	        
	         , A.BOARD_COUNT
	         , A.COMMUNITY_WRITE_DATE
	         , A.CUSTOM
          FROM (SELECT 
                       ROWNUM RNUM
                     , B.COMMUNITY_NO
                     , B.BOARD_TYPE
			         , A.COMMUNITY_TITLE
	         		 , A.COMMUNITY_STORY
			         , B.MEMBER_NO
			         , B.BOARD_COUNT
			         , B.COMMUNITY_WRITE_DATE
			         , B.CUSTOM
                  FROM (SELECT 
                               C.COMMUNITY_NO
					         , C.BOARD_TYPE
					         , C.COMMUNITY_TITLE
					         , C.COMMUNITY_STORY
					         , C.MEMBER_NO
					         , C.BOARD_COUNT
					         , C.COMMUNITY_WRITE_DATE
					         , C.CUSTOM
                          FROM TBL_COMMUNITY C
                         WHERE C.CUSTOM = 1
				           AND C.MEMBER_NO = 2
        				 ORDER BY C.COMMUNITY_NO DESC
        				) B
        <![CDATA[
                  WHERE ROWNUM <= #{ endRow }
                  ]]>
        ) A
        JOIN TBL_FILE D ON (A.BOARD_NO = D.REF_BOARD_NO)
        JOIN TBL_MEMBER E ON(A.BOARD_WRITER_MEMBER_NO = E.MEMBER_NO)
        WHERE A.RNUM >= #{ startRow }
        ORDER BY 1 DESC
    </select>
    
    
    
    





   

















</mapper>